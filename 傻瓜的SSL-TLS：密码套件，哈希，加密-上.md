---
title: 傻瓜的SSL/TLS：密码套件，哈希，加密，密钥交换算法(上)
date: 2018-08-01 21:39:19
tags: Crypto
---
# 傻瓜的SSL/TLS：密码套件，哈希，加密，密钥交换算法(上)
 <center ><font size=6> 密码套件，哈希，加密 </font></center >
作为一名安全爱好者，我总是喜欢SSL（TLS最近）的工作。我花了几天时间来理解这个复杂协议的基本工作。但是一旦你理解了底层的概念和算法，整个协议就会感觉很简单。在学习SSL工作的过程中，我学到了很多东西。加密是SSL-TLS第一件事。我开始回忆起从大学学到的密码学的东西。那些日子，我在研究它们时就像是我。现在，我知道为什么教师用我所有的加密东西来帮助我。我知道密码学有多少让我的生活更轻松。我想在我的空间分享我在这里学到的一切。我绝对希望这对你有用。让我们开始吧。

### SSL的历史
在谈论SSL的历史时，不应该错过Mozilla Foundation。在谈论Mozilla时，我们首先想到的是他们着名的浏览器Firefox。根据各种消息来源，Firefox是Chrome和Safari之后最受欢迎的浏览器。但[Netscape](https://en.wikipedia.org/wiki/Netscape)是Firefox的伟大前身，在90年代它是互联网用户中最受欢迎的浏览器。无论如何，通过微软引入Internet Explorer，Netscape的时代结束了，后来他们开始了伟大的Mozilla基金会，它仍然在增长。Mozilla的网景

Netscape于1994年为其Netscape Navigator浏览器引入了SSL。主要目标是[防止中间人](https://security.stackexchange.com/questions/78843/origins-of-the-man-in-the-middle-analysis)攻击。后来，随着互联网可访问性的增加，银行开始利用互联网进行交易。那时，安全性是一个主要问题，IETF （互联网工程任务组），标准化互联网协议的人，通过制作自己的版本来标准化SSL。这是在1999年，现在该协议被称为TLS（传输层安全性，最新版本是TLS 1.3。

### 关于密码学的几点注意事项
首先，在深入研究主题之前，我们需要对几件事情有一个基本的了解。最重要的一个是密码学。您不需要成为密码学专家来理解SSL。但基本的理解是必要的。我们将在这里讨论基础知识。那些已经知道非对称和对称密钥加密的人可以跳过本节并转到下一部分。

二进制加密因此密码学处理数字和字符串。基本上整个宇宙中的每一个数字事物都是数字。当我说数字时，它是0和1.你知道它们是什么，二进制。你在屏幕上看到的图像，你通过耳机收听的音乐，一切都是二进制文件。但是我们的耳朵和眼睛不会理解二进制文件吗？只有大脑才能理解这一点，即使它能够理解二进制文件，它也无法享受二进制文件。因此，我们将二进制文件转换为人类可理解的格式，如mp3，jpg等。我们将这个过程称为**编码**。它是双向处理，可以很容易地解码回原始形式。

### 哈希
**散列**是另一种加密技术，其中一旦转换为其他形式的数据永远无法恢复。在Layman的术语中，没有称为去散列的过程。有很多哈希函数可以完成这项工作，比如sha-512，md5等等。wst.space 的sha-512 值是，
```
83d98e97ec1efc3cb4d20f81a246bff06a1c145b7c06c481defed6ef31ce6ad78db3ecb36e7ce097966f019eab7bdc7ffa6b
3f b8c5226871667ae13a6728c63b
```
您可以通过访问某个[在线哈希创建者网站](https://passwordsgenerator.net/sha512-hash-generator/)并输入wst.space 来验证这一点。

如果原始值无法恢复，那么我们在哪里使用它？密码！为移动设备或PC设置密码时，会创建密码哈希并存储在安全的位置。当您下次进行登录尝试时，再次使用相同的算法（散列函数）对输入的字符串进行散列，并将输出与存储的值进行匹配。如果它是相同的，你就会登录。否则你就会被抛弃。
![]()

通过对密码应用哈希，我们可以确保攻击者即使窃取存储的密码文件也永远不会得到我们的密码。攻击者将拥有密码的哈希值。他可能会找到最常用密码的列表，并将sha-512 应用于每个密码，并将其与手中的值进行比较。它被称为字典攻击。但他会这样做多久？如果您的密码足够随机，您认为这种破解方法是否有效？

我们在[一篇博客文章](https://www.wst.space/understanding-cookies-1/)中讨论了[会话cookie](https://www.wst.space/understanding-cookies-1/)。值是会话cookie通常是哈希值。Facebook，Google和亚马逊数据库中的所有密码都经过哈希处理，或者至少它们应该被哈希化。

### 然后是加密
加密位于散列和编码之间。编码是一个双向过程，不应用于提供安全性。加密也是一个双向过程，但当且仅当加密密钥已知时才能检索原始数据。如果您不知道加密的工作原理，请不要担心，我们将在此讨论基础知识。这足以理解SSL的基础知识。因此，有两种类型的加密，即对称加密和非对称加密。

### 对称密钥加密
我想尽可能简单地保持事情。因此，让我们通过移位算法来理解对称加密。此算法用于通过将字母向左或向右移动来加密字母表。我们取一个字符串CRYPTO并考虑一个数字+3。然后，CRYPTO的加密格式将是FUBSWR。这意味着每个字母向右移动3个位置。

这里，单词CRYPTO称为明文，输出FUBSWR称为密文，值+3称为加密 密钥（对称密钥），整个过程为密码。这是最古老和最基本的对称密钥加密算法之一，其首次使用是在Julius Caesar时期报道的。因此，它以他的名字命名，它是着名的凯撒密码。任何知道加密密钥并且可以应用凯撒算法的反向并检索原始明文的人。因此，它被称为对称加密。
![]()

##### 我们可以使用TLS进行对称加密吗？
如您所知，这种算法很容易破解，因为可能性较小。我们可以将key的值从1更改为任何内容，并逐个迭代26个字母。请注意，如果我们只加密小写英文字母，则key的值限制为26。我们的计算机在这个过程中使用Bruteforce只需几毫秒。如今，存在诸如AES（高级加密标准）和3DES（三重数据加密算法）的复杂算法。他们被认为真的很难破解。 

这是在发送和接收数据时在SSL / TLS中使用的加密技术。但是，客户端和服务器需要在开始加密数据之前就密钥达成一致并进行交换，对吗？交换密钥的最初步骤显然是纯文本。如果攻击者在共享密钥时捕获密钥怎么办？然后使用它是没有意义的。因此，我们需要一种安全机制来交换密钥，而不会让攻击者真正看到它。出现了非对称密钥加密的作用。

### 非对称密钥加密
我们知道，在对称加密中，相同的密钥用于加密和解密。一旦该密钥被盗，所有数据都将消失。这是一个巨大的风险，我们需要更复杂的技术。1976年，Whitfield Diffie和Martin Hellman首次发布了非对称加密的概念，该算法被称为Diffie-Hellman密钥交换。然后在1978年，麻省理工学院的Ron Rivest，Adi Shamir和Leonard Adleman发表了RSA 算法。这些可以被视为非对称加密的基础。
![]()

与对称加密相比，在非对称加密中，将有两个键而不是一个。一个称为公钥，另一个称为私钥。理论上，在启动期间，我们可以生成公私钥匙对我们的机器。私钥应保存在安全的地方，绝不应与任何人共享。顾名思义，公钥可以与希望向您发送加密文本的任何人共享。现在，那些拥有您的公钥的人可以使用它加密秘密数据。如果密钥对是使用RSA算法生成的，那么它们应该在加密数据时使用相同的算法。通常，算法将在公钥中指定。加密数据只能使用您拥有的私钥解密。

#### 我们可以对所有TLS使用非对称加密吗？
非对称加密也称为公钥基础结构又称PKI ，原因是自解释。无论如何，只要您保持私钥安全，数据就是安全的。大！所以，现在你可能会想，为什么我们仍然会在TLS中使用对称加密？我们有很多安全的PKI 。是的，同意，但应该指出，必须在不影响可用性的情况下处理安全问题。由于PKI涉及双密钥架构并且密钥长度通常很大，因此加密 - 解密开销非常高。与对称密钥加密相比，它需要更多的时间和CPU使用。加密模因

因此，当在客户端和服务器之间发送和接收数据时，用户将感觉更多的等待时间，并且浏览器将开始吃掉CPU。因此PKI仅用于在客户端和服务器之间交换对称密钥。此后，对称密钥加密开始起作用，并且进一步的数据传输利用了这种技术。好吧，我知道我在这里只是在灌木丛中殴打。因为我还没有真正涉足这个话题。请记住我们到目前为止所讨论的内容并回到这个空间。我们将从下一篇博客文章深入探讨。


<center ><font size=6>**密钥交换算法**</font></center >
在博客系列的最后部分，我们讨论了密码学的基本概念。它包括散列，对称和非对称加密等。除了他们的历史，我没有说过任何关于SSL或TLS的内容。我希望我们已经完成了基础。所以让我们挖掘真实的东西吧。在这篇博文中，我们将根据Diffie-Hellman密钥呼出来讨论密钥交换算法。 

### 了解SSL中的加密类型
从[博客系列](https://www.wst.space/ssl-part1-ciphersuite-hashing-encryption/)的[最后一部分开始](https://www.wst.space/ssl-part1-ciphersuite-hashing-encryption/)，我们知道在SSL中使用了对称加密和非对称加密。我们将看到哪个，哪里以及为什么。

想象一下，你正在浏览Facebook。Facebook默认情况下通过https重新路由您的所有流量。由于您使用的是TLS（我将在大多数地方使用TLS而不是SSL，因为它现在是标准的）连接，您会在URL栏上看到一个绿色框，确认连接是安全的。在单个会话期间，您将进行多项活动，例如评论，聊天，在页面之间导航，滚动新闻源等。每次执行此操作时，客户端和服务器之间共享多个请求和响应。所有这些通信都必须通过https才能确保数据安全。这意味着服务器和客户端浏览器正在为单个Facebook会话加密和解密数据包100次。
![]()
我们知道公钥加密比对称密钥加密更安全，因为解密密钥永远不会与任何人共享。但是，如果我们知道，在公钥基础设施（PKI）中，开销非常高。与对称密钥加密相比，它使用更多的CPU并且需要更多的时间来加密和解密。结果，浏览器（和应用程序服务器）开始占用您的CPU资源。此外，浏览器将花费更多时间来提供内容，因为它每次都必须经历繁忙的加密步骤。

### 解决办法是什么？
因此，我们使用对称加密来实现这一目标，这样更快，资源消耗更少。都好。但是客户端和服务器在开始加密之前必须就单个密钥达成一致，对吧？他们会怎么做？在共享唯一的密钥时，坐在客户端和服务器之间的攻击者可以捕获它和Kaboom！您的所有数据都消失了。因此，必须有一种解决方法来共享密钥，并在那里我们使用公钥加密。

同意一个秘密密钥并在客户端和服务器之间共享它称为握手，这是TLS的第一步。握手涉及多个过程。整个过程称为公钥基础结构。还记得我们在系列的最后部分使用了这个术语吗？PKI包括证书颁发机构（CA），数字签名等。我们将在下面深入讨论基础架构。

### 密钥交换算法
因此，很明显非对称加密用于交换密钥，但哪种算法？自从非对称密码学发明以来，提出了许多算法。在写这篇文章的过程中，TLS 1.2是常用的标准和RSA，Diffie-Hellman密钥交换，ECDH（Elliptic Curve Diffie-Hellman），SRP（安全远程密码），PSK（Pre Shared Key）是密钥交换算法由TLS 1.2支持。

在这里讨论所有算法可能是个坏主意。相反，我们将讨论最常见且易于理解的Diffie-Hellman密钥交换算法。

### Diffie-Hellman Key Exchange解释道
我不是直接去算，因为我很弱。相反，让我们尝试用颜色类比来理解这个概念。想象一下，爱丽丝和鲍勃正在做海报工作。他们的对手马洛里也坐在替补席旁边。爱丽丝和鲍勃想要同意一种颜色来设计海报。他们无法大声讨论，因为马洛里会听到它。那么他们如何达到共同的颜色呢？该解决方案是Diffie-Hellman密钥交换算法的最简单形式。我们来看看如何。

#### 脚步
- 1.首先，爱丽丝会选择一种常见的颜色，比如黄色，并告诉鲍勃，她将在本次会议中使用黄色。显然，马洛里会听到它，没关系。
- 2.爱丽丝和鲍勃现在选择他们自己的秘密颜色，他们不会在彼此之间分享。所以马洛里永远不会知道秘密色彩。例如，Alice选择秘密颜色Orange，Bob选择Green。
- 3.在此步骤中，Alice将混合她的秘密颜色橙色和常用颜色黄色以产生新颜色。凉鞋的颜色是对的吗？（我的颜色感觉不太好，原谅我。）
- 4.同样，Bob也将他的秘密颜色与黄色混合以生成新的蓝色。
- 5.Alice和Bob将在他们之间分享这些新颜色。马洛里可以看到凉鞋颜色和蓝色，但不是他们的秘密颜色。
- 6.交换完成后，Alice会将她的秘密颜色（橙色）混合到Bob发送的混合物中。Bob会将他的秘密颜色（绿色）与Alice发送的混合物混合。
- 7.现在爱丽丝和鲍勃都达到了一种共同秘密色彩的混合物。请参考下图。Mallory将会被Sandal和Blue困住，因为Mallory不知道Alice和Bob的秘密颜色，所以它永远不会达到常见的秘密颜色。
![]()
这里，Common paint（Yellow）可以被视为服务器的公钥，每个人都可以使用。最后获得的公共秘密可以被认为是用于在进一步的会话中加密数据的对称密钥。这不完全正确，但对于基本的理解，让我们保持这样。如果你深入挖掘，你会理解精确的逻辑。

Diffie-Hellman密钥交换背后的数学
让我们找出上述算法背后的基本数学。我们需要了解模块化算法以更好地理解Diffie-Hellman的概念。那些不想要数学的人可以跳过本节，其他人请关注我。

你知道，当你添加7和8时，你得到15.这是正常的算术。但是在12小时的情况下，情况并非如此。如果时间现在是7点钟，那么8小时后，时间将是3点钟。因此，我们可以说时钟是算术模12的模运算的最简单的例子。在这种情况下，我们知道12:00类似于00:00，因此我们可以说12与0一致，反之亦然。

在数学上，
$$ A = b(mod _P)$$
如果我们将p的值设为12，将b设为21.然后，
21（mod 12）= 9

让我们将其转换为Diffie-Hellman示例。在阅读以下内容时，请记住颜色类比。想象一下，Alice和Bob都知道g和p的值，或者Alice先前决定了这些值并将其发送给Bob。换句话说，这些价值观是公开的。现在，


观察到小号甲 = 小号乙 = K 。这是将用于加密会话的会话密钥。

马洛里获得秘密钥匙的机会
在整个过程中，请注意Alice（a）的秘密和Bob（b）的秘密永远不会彼此共享。因此，马洛里只知道g，p，A和B.为了得到K的值，Mallory首先需要从A = g a（mod p）和B = g b（mod p）计算a＆b 。它被称为离散对数问题。对于较大的p值，发现该机制几乎100％不可行。在实际的TLS实现中，p的长度将在1024或2048位的范围内。也就是说，2048位密钥的长度在  2 2047和 2 2048之间。希望你知道一个  2 3 length key的最大值可以为8.想象一下2048位密钥的复杂性。

当使用这样的密钥时，世界上最大的超级计算机将花费100年的时间来计算a＆b。但是，这些值会随着每个会话而变化。因此，即使攻击者计算了此值，他也无法使用它们在以下会话中模拟用户。这就是所谓的完美前瞻性保密。

我们现在安全吗？
服务器和客户端浏览器已经同意通过强密钥交换算法安全共享的密钥。一切都很好看。但等等，我足够安全吗？让我们想象一下我们尝试通过https连接到facebook.com的场景。假设攻击者已经位于您的浏览器和Facebook服务器之间。您的浏览器将告诉Facebook服务器启动TLS通道。但攻击者可以设置自己的服务器，并通过他的服务器重新路由你和Facebook.com之间的所有通信。因此，当Facebook服务器发送其公钥时，攻击者可以用他的公钥替换它并将其转发给您。你还没有得到它吗？

问题？

进入下一步。您收到公钥认为它实际上来自Facebook.com，您的浏览器将使用它加密您的密钥并将其发送回Facebook。再一次，攻击者会抓住它并猜猜是什么？他有相应的私钥来解密密钥，然后用Facebook.com的公钥（他已经拥有）的原始值加密它并将其转发回Facebook.com。他将继续进行加密 - 解密过程，他可以看到你和Facebook.com之间共享的所有内容。

该死的，现在怎么办？
问题的答案是CA（证书颁发机构）。简单来说，证书颁发机构由X.509标准指定，以确保数据完整性。数据完整性可确保传输中的数据不会被第三方实体篡改。换句话说，CA充当浏览器和服务器之间的中间人。确保数据完整性是CA的职责。

我们将在下一篇博客文章中深入讨论CA. 如果您发现该文章有用，请考虑捐赠我。为此，您只需点击页面中显示的任何广告，然后浏览广告几秒钟即可。谢谢.